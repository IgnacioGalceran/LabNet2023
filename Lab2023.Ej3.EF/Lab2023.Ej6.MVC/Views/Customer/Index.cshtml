@model List<Lab2023.Ej3.EF.Logic.DTO.CustomersDTO>
@{
    ViewBag.Title = "Customer Page";
}

<h1>Customer Index</h1>

<table class="table">
    <thead>
        <tr>
            <th scope="col">#</th>
            <th scope="col">First</th>
            <th scope="col">Last</th>
            <th scope="col">Handle</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var customer in Model)
        {
            <tr>
                <th scope="row">@customer.CustomerID</th>
                <td>@customer.ContactName</td>
                <td>@customer.CompanyName</td>
                <td>@customer.City</td>
                <td><button onclick="deleteCustomer('@Html.Raw(customer.CustomerID)')" class="btn btn-danger">Delete</button></td>
           </tr>
        }
        
    </tbody>
</table>

@section Scripts{
    <script type="text/javascript" charset="utf-8">
        function deleteCustomer(idCustomer) {

            Swal.fire({
                title: 'Estás seguro?',
                text: "No podrás revertir esta operación",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Si, borrar!'
            }).then((result) => {
                if (result.isConfirmed) {
                    confirmDelete(idCustomer);
                }
            })
        }

        function confirmDelete(idCustomer) {
            $.ajax({
                url: '@Url.Action("DeleteCustomer", "Customer")',
                method: 'POST',
                data: {
                    idCustomer: idCustomer,
                },
                dataType: "json",
                success: function (data) {
                    if (data.result) {
                        Swal.fire(
                            'Borrado!',
                            'El customer ha sido borrado.',
                            'success'
                        );
                    } else {
                        Swal.fire(
                            'Error!',
                            'No se pudo borrar el customer.',
                            'error'
                        );
                    }
                    console.log(data);
                },
                error: function (xhr, textStatus, errorThrown) {
                    console.log(textStatus);
                    console.log(errorThrown);
                }
            });
        }
    </script>    
}