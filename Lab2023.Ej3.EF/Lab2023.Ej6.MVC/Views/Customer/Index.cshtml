@model List<Lab2023.Ej3.EF.Logic.DTO.CustomersDTO>
@{
    ViewBag.Title = "Customer Page";
}

<div class="title-container">
    <h1>Lista de Clientes</h1>
    <button class="btn btn-dark" onclick="window.location.href='/Customer/Form'"><i class="fa-solid fa-plus"></i> Agregar Cliente</button>
</div>

<div>
    <input type="text" id="filter-name" class="filter" placeholder="Buscar por nombre">
    <i class="fa-solid fa-magnifying-glass"></i>
</div>

<div class="table-container">
    <table class="table">
        <thead>
            <tr>
                <th scope="col">Nombre</th>
                <th scope="col">Compañía</th>
                <th scope="col">Ciudad</th>
                <th scope="col">Opciones</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var customer in Model)
            {
                <tr id="cliente_@customer.CustomerID">
                    <td>@customer.ContactName</td>
                    <td>@customer.CompanyName</td>
                    <td>@customer.City</td>
                    <td>
                        <button onclick="deleteCustomer('@Html.Raw(customer.CustomerID)')" class="btn btn-outline-danger"><i class="fa-solid fa-trash"></i></button>
                        <button class="btn btn-outline-info" onclick="window.location.href='/Customer/Form/@Html.Raw(customer.CustomerID)'"><i class="fa-solid fa-pen-to-square"></i></button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

@section Scripts{
    <script type="text/javascript" charset="utf-8">

        function deleteCustomer(idCustomer) {

            Swal.fire({
                title: 'Estás seguro?',
                text: "No podrás revertir esta operación",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Si, borrar!'
            }).then((result) => {
                if (result.isConfirmed) {
                    confirmDelete(idCustomer);
                }
            })
        }

        function confirmDelete(idCustomer) {
            $.ajax({
                url: '@Url.Action("DeleteCustomer", "Customer")',
                method: 'POST',
                data: {
                    idCustomer: idCustomer,
                },
                dataType: "json",
                success: function (data) {
                    if (data.result) {
                        Swal.fire(
                            'Borrado!',
                            'El Cliente ha sido borrado.',
                            'success'
                        );
                        $('#cliente_' + idCustomer).remove();
                    } else {
                        Swal.fire(
                            'Error!',
                            'No se pudo borrar el cliente.',
                            'error'
                        );
                    }
                },
                error: function (xhr, textStatus, errorThrown) {
                    Swal.fire(
                        'Error!',
                        textStatus,
                        'error'
                    );
                }
            });
        }

        $(document).ready(function () {
            $('#filter-name').on('input', function () {
                var filter = $(this).val().toLowerCase();

                $('table tbody tr').each(function () {
                    var name = $(this).find('td:first').text().toLowerCase();
                    if (name.includes(filter)) {
                        $(this).show();
                    } else {
                        $(this).hide();
                    }
                });
            });
        });
    </script>    
}